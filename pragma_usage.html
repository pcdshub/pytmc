

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Annotating a TwinCAT3 project &mdash; pytmc  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Documentation" href="source_code.html" />
    <link rel="prev" title="Command-line Usage" href="terminal_usage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pytmc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="terminal_usage.html">Command-line Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="terminal_usage.html#templates">Templates</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Annotating a TwinCAT3 project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-and-record-types">Data and Record Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pragma-syntax">Pragma syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reducing-update-rate">Reducing update rate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declaring-top-level-variables">Declaring top level variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declaring-encapsulated-variables">Declaring encapsulated variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declaring-bidirectional-pvs">Declaring bidirectional PVs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pragma-fields">Pragma fields</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pv">pv</a></li>
<li class="toctree-l4"><a class="reference internal" href="#io">io</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fields">fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scan">SCAN</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="source_code.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="source_code.html#module-pytmc.pragmas">pytmc.pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="source_code.html#module-pytmc.record">pytmc.record</a></li>
<li class="toctree-l1"><a class="reference internal" href="source_code.html#module-pytmc.parser">pytmc.parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="source_code.html#module-pytmc.linter">pytmc.linter</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pytmc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="user_guide.html">User Guide</a> &raquo;</li>
        
      <li>Annotating a TwinCAT3 project</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/pragma_usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="annotating-a-twincat3-project">
<h1>Annotating a TwinCAT3 project<a class="headerlink" href="#annotating-a-twincat3-project" title="Permalink to this headline">¶</a></h1>
<p>Pytmc is capable of generating most of the DB file but some settings require
human direction. Developers set this configuration by adding an attribute
pragma to TwinCAT3 variables when they’re declared. These pragmas can be
appended to variables in project files and library files.</p>
<div class="section" id="data-and-record-types">
<h2>Data and Record Types<a class="headerlink" href="#data-and-record-types" title="Permalink to this headline">¶</a></h2>
<p>TwinCAT data types and their corresponding record types are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 17%" />
<col style="width: 16%" />
<col style="width: 9%" />
<col style="width: 11%" />
<col style="width: 13%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Data type</p></th>
<th class="head"><p>Lower bound</p></th>
<th class="head"><p>Upper bound</p></th>
<th class="head"><p>Memory space</p></th>
<th class="head"><p>Record Type</p></th>
<th class="head"><p>Scalar DTYP</p></th>
<th class="head"><p>Waveform DTYP</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BOOL</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>8 bit</p></td>
<td><p>bi, bo</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt8ArrayIn, asynInt8ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>BYTE</p></td>
<td><p>0</p></td>
<td><p>255</p></td>
<td><p>8 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt8ArrayIn, asynInt8ArrayOut</p></td>
</tr>
<tr class="row-even"><td><p>SINT</p></td>
<td><p>-128</p></td>
<td><p>127</p></td>
<td><p>8 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt8ArrayIn, asynInt8ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>USINT</p></td>
<td><p>0</p></td>
<td><p>255</p></td>
<td><p>8 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt8ArrayIn, asynInt8ArrayOut</p></td>
</tr>
<tr class="row-even"><td><p>WORD</p></td>
<td><p>0</p></td>
<td><p>65535</p></td>
<td><p>16 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt16ArrayIn, asynInt16ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>INT</p></td>
<td><p>-32768</p></td>
<td><p>32767</p></td>
<td><p>16 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt16ArrayIn, asynInt16ArrayOut</p></td>
</tr>
<tr class="row-even"><td><p>UINT</p></td>
<td><p>0</p></td>
<td><p>65535</p></td>
<td><p>16 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt16ArrayIn, asynInt16ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>ENUM</p></td>
<td><p>0</p></td>
<td><p>4294967295</p></td>
<td><p>32 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt16ArrayIn, asynInt16ArrayOut</p></td>
</tr>
<tr class="row-even"><td><p>DWORD</p></td>
<td><p>0</p></td>
<td><p>4294967295</p></td>
<td><p>32 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt32ArrayIn, asynInt32ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>DINT</p></td>
<td><p>-2147483648</p></td>
<td><p>2147483647</p></td>
<td><p>32 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt32ArrayIn, asynInt32ArrayOut</p></td>
</tr>
<tr class="row-even"><td><p>UDINT</p></td>
<td><p>0</p></td>
<td><p>4294967295</p></td>
<td><p>32 bit</p></td>
<td><p>longin, longout</p></td>
<td><p>asynInt32</p></td>
<td><p>asynInt32ArrayIn, asynInt32ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>LWORD</p></td>
<td><p>0</p></td>
<td><p>2**64-1</p></td>
<td><p>64 bit</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>LINT</p></td>
<td><p>-2**63</p></td>
<td><p>2**63-1</p></td>
<td><p>64 bit</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p>ULINT</p></td>
<td><p>0</p></td>
<td><p>2**64-1</p></td>
<td><p>64 bit</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>REAL</p></td>
<td><p>-3.4E+38</p></td>
<td><p>3.4E+38</p></td>
<td><p>32 bit</p></td>
<td><p>ai, ao</p></td>
<td><p>asynFloat64</p></td>
<td><p>asynFloat32ArrayIn, AsynFloat32ArrayOut</p></td>
</tr>
<tr class="row-odd"><td><p>LREAL</p></td>
<td><p>-1.797693134862316e+308</p></td>
<td><p>1.797693134862358e+308</p></td>
<td><p>64 bit</p></td>
<td><p>ai, ao</p></td>
<td><p>asynFloat64</p></td>
<td><p>asynFloat64ArrayIn, AsynFloat64ArrayOut</p></td>
</tr>
<tr class="row-even"><td><p>STRING</p></td>
<td></td>
<td></td>
<td><p>Varies</p></td>
<td><p>waveform</p></td>
<td><p>asynFloat64</p></td>
<td><p>asynInt8ArrayIn, asynInt8ArrayOut</p></td>
</tr>
</tbody>
</table>
<p>Lines marked as N/A are not supported by pytmc.</p>
</div>
<div class="section" id="pragma-syntax">
<h2>Pragma syntax<a class="headerlink" href="#pragma-syntax" title="Permalink to this headline">¶</a></h2>
<p>At a minimum, developers must specify a PV. Specifying an IO direction for each
field is recommended but not required. This would look like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: TEST:MAIN:SCALE
    io: i
&#39;}
scale : LREAL := 0.0;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">{attribute</span> <span class="pre">'pytmc'</span> <span class="pre">:=</span> <span class="pre">'</span></code> and <code class="docutils literal notranslate"><span class="pre">'}</span></code> specify the beginning and end of the
pragma that pytmc will recognize. The middle two lines specify the
configuration for this variable.</p>
<p>Pytmc uses a custom system of configuration where newlines and white space in
a line is important. All lines begin with a title and the title ends before the
colon. All parts thereafter are the ‘tag’ or the configuration state for this
setting. Some title types such as <code class="docutils literal notranslate"><span class="pre">field</span></code> can have multiple settings for a
single PV.</p>
<p>A pragma could have multiple fields specified. For example, an <code class="docutils literal notranslate"><span class="pre">ai</span></code> record
<code class="docutils literal notranslate"><span class="pre">TEST:MAIN:SCALE</span></code> would be generated from the following, with a slope of
2.0 and an offset of 1.0, updating only at a rate of once per second:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: TEST:MAIN:SCALE
    io: i
    field: SCAN 1 second
    field: AOFF 1.0
    field: ASLO 2.0
&#39;}
scale : LREAL := 0.0;
</pre></div>
</div>
</div>
<div class="section" id="reducing-update-rate">
<h2>Reducing update rate<a class="headerlink" href="#reducing-update-rate" title="Permalink to this headline">¶</a></h2>
<p>By default, all records will have a scan rate of <code class="docutils literal notranslate"><span class="pre">I/O</span> <span class="pre">Intr</span></code>. This means that
even if the value updates on every PLC cycle, EPICS will see (most) of those
events.</p>
<p>In the case of values that update quickly, it may be preferable to reduce
the rate at which EPICS sees updates. This can be done by setting the
<cite>SCAN</cite> field to poll at a fixed rate.</p>
</div>
<div class="section" id="declaring-top-level-variables">
<h2>Declaring top level variables<a class="headerlink" href="#declaring-top-level-variables" title="Permalink to this headline">¶</a></h2>
<p>This is an example of the simplest configuration a developer can provide to
instantiate a variable.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: TEST:MAIN:SCALE
    io: i
&#39;}
scale : LREAL := 0.0;
</pre></div>
</div>
<p>The developer must specify the PV name (<code class="docutils literal notranslate"><span class="pre">pv:</span></code> line). All other fields are
optional. We recommend that the user specify the direction of the
data (<code class="docutils literal notranslate"><span class="pre">io:</span></code> line) however.</p>
<p>Pytmc needs no additional information but users have the option to override
default settings manually. For example a developer can specify the <code class="docutils literal notranslate"><span class="pre">SCAN</span></code>
field , which configures how and when the value is updated, even though this is
not required. For additional information on all the pragma fields, consult the
<a class="reference internal" href="#pragma-fields">Pragma fields</a> section.</p>
</div>
<div class="section" id="declaring-encapsulated-variables">
<h2>Declaring encapsulated variables<a class="headerlink" href="#declaring-encapsulated-variables" title="Permalink to this headline">¶</a></h2>
<p>Variables declared inside of data structures can be processed by pytmc so long
as each level of encapsulation, all the way down to the first level, is marked
for pytmc.</p>
<p>The instantiation of encapsulating data types only needs the <code class="docutils literal notranslate"><span class="pre">pv:</span></code> line. The
instantiation of a function block could resemble the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: TEST:MAIN:COUNTER_B
&#39;}
counter_b : counter;
</pre></div>
</div>
<p>A variable declared within the <code class="docutils literal notranslate"><span class="pre">counter</span></code> function block could resemble the
following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: VALUE
    io: i
&#39;}
value_d : DINT;
</pre></div>
</div>
<p>When combined, the PV specified at the instantiation of the user-defined data
type will be appended to the beginning of the PV for all data types defined
within. Each step further into a data structure can add an additional section
to the PV. In the example above the final PV will be
<code class="docutils literal notranslate"><span class="pre">TEST:MAIN:COUNTER_B:VALUE</span></code>. The colons are automatically included.</p>
<p>This can be recursively applied to data types containing data types.</p>
<p>Information other than the PV name name can be specified at the datatype
instantiation if you wish to make generalizations about the variables
contained inside. These generalizations are overridden if the same field is
specified either on a contained datatype or variable.</p>
<p>For example the following code block will assign a <code class="docutils literal notranslate"><span class="pre">field:</span></code> of <code class="docutils literal notranslate"><span class="pre">SCAN</span> <span class="pre">1</span>
<span class="pre">second</span></code> to all the variables and datatypes that it contains unless they
specify their own setting for <code class="docutils literal notranslate"><span class="pre">SCAN</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: BASE
    field: SCAN 1 second
&#39;}
counter_b : counter;
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: VALUE_F_R
    field: SCAN 1 second
    io: i
&#39;}
value_d : DINT;
</pre></div>
</div>
</div>
<div class="section" id="declaring-bidirectional-pvs">
<h2>Declaring bidirectional PVs<a class="headerlink" href="#declaring-bidirectional-pvs" title="Permalink to this headline">¶</a></h2>
<p>In instances where a single TwinCAT variable should be able to be both written
and read, multiple PVs can be specified. This allows multiple EPICS records to
be tied to a single TwinCAT variable.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{attribute &#39;pytmc&#39; := &#39;
    pv: TEST:MAIN:ULIMIT
    io: io
&#39;}
upper_limit : DINT := 5000;
</pre></div>
</div>
<p>In this case, two records will be generated: <code class="docutils literal notranslate"><span class="pre">TEST:MAIN:ULIMIT</span></code> and
<code class="docutils literal notranslate"><span class="pre">TEST:MAIN:ULIMIT_RBV</span></code>.</p>
</div>
<div class="section" id="pragma-fields">
<h2>Pragma fields<a class="headerlink" href="#pragma-fields" title="Permalink to this headline">¶</a></h2>
<p>Each line of the pragma indicates to pytmc how to generate the corresponding records
in the database file output.</p>
<div class="section" id="pv">
<h3>pv<a class="headerlink" href="#pv" title="Permalink to this headline">¶</a></h3>
<p>This constructs the PV name that will represent this variable in EPICS. It is
the only mandatory configuration line. This line can be used on specific
variables as well as the instantiations of data types.</p>
<p>When used on variables declared in the main scope, the PV for the variable will
be generated verbatim.  When used on instantiations, this string will be
appended to the front of any PVs that are declared within the data type.</p>
</div>
<div class="section" id="io">
<h3>io<a class="headerlink" href="#io" title="Permalink to this headline">¶</a></h3>
<p>This is a guessed field that defaults to <cite>‘io’</cite>.  Specify the whether the IOC
is reading or writing this value. Values being sent from the PLC to the IOC
should be marked as input with ‘i’ and values being sent to the PLC from the
IOC should be marked ‘o’.  Bidirectional PVs can be specified with ‘io’.</p>
</div>
<div class="section" id="fields">
<h3>fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h3>
<p>This specifies additional field(s) to be set on the generated EPICS record(s).
Multiple field lines are allowed. These lines determine the PV’s behaviors such
as alarm limits and scanning frequency.</p>
<p>The format is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>field: FIELD_NAME field value
</pre></div>
</div>
<p>This would correspond to a field in the record being generated as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>record(ai, &quot;my_record&quot;) {
   ...
   field(FIELD_NAME, &quot;field value&quot;)
}
</pre></div>
</div>
</div>
<div class="section" id="scan">
<h3>SCAN<a class="headerlink" href="#scan" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">SCAN</span></code> field is special. Pytmc will guess a scan field if not provided
but like <code class="docutils literal notranslate"><span class="pre">io</span></code> and <code class="docutils literal notranslate"><span class="pre">pv</span></code>, the correct setting is on a case-by-case basis.
pytmc itself cannot know at what rate a variable will update on the PLC side.</p>
<p>Valid options for this field are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;Passive&quot;
&quot;I/O Intr&quot;
&quot;10 second&quot;
&quot;5 second&quot;
&quot;2 second&quot;
&quot;1 second&quot;
&quot;.5 second&quot;
&quot;.2 second&quot;
&quot;.1 second&quot;
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="source_code.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="terminal_usage.html" class="btn btn-neutral float-left" title="Command-line Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SLAC National Accelerator Laboratory

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>